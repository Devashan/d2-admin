import { computed } from '/node_modules/.vite/vue.js?v=56359903'
import { keys, values, fromPairs } from '/node_modules/.vite/lodash-es.js?v=56359903'
import { useWindowSize } from '/src/libs/d2-use/window-size.js'
import { useD2ComponentsConfig } from '/src/libs/d2-use/config.js'

/**
 * Get breakpoint status
 * @param {Object} breakPoints break point setting, if do not set this parameter, use global config
 *                             eg { sm: 640, md: 768, lg: 1024, xl: 1280, xxl: 1536 }
 * @returns {Object} status {String} breakPoint now active break point name
 * @returns {Object} status {String} ...breakPoints.keys active state of each breakpoint
 * @returns {Object} status {String} min less than the minimum breakpoint
 */
export function useBreakPoint (breakPoints) {
  const { width } = useWindowSize()

  const d2ComponentsConfig = useD2ComponentsConfig()
  
  const _breakPoints = Object.assign({ min: 0 }, d2ComponentsConfig.breakPoints, breakPoints)

  debugger
  const names = keys(_breakPoints)
  const widths = values(_breakPoints).sort((a, b) => a - b)
  const dict = fromPairs(widths.map((w, i) => [w, names[i]]))

  const widthActive = computed(() => widths.reduce((r, e) => width.value >= e ? e : r, 0))

  const breakPoint = computed(() => dict[widthActive.value] || 'min')

  const isMin = computed(() => breakPoint.value === 'min')

  const status = fromPairs(names.map(e => [e, computed(() => breakPoint.value === e)]))

  /**
   * match values based on breakpoints
   * @param {*} value default value
   * @param {*} valueSet set of values matched by breakpoints
   * @returns a matched value
   */
  function responsive (value, valueSet = {}) {
    return computed(() => {
      const point = dict[
        Math.max(
          ...keys(valueSet)
            .map(e => _breakPoints[e])
            .filter(e => e <= widthActive.value)
        )
      ]
      return valueSet[point] || value
    })
  }

  return {
    responsive,
    breakPoint,
    min: isMin,
    ...status
  }
}
